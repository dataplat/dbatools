# this files describes which tests to run on which environment of the build matrix

$TestsRunGroups = @{
    # run on scenario SINGLE - tests that need just a single instance
    "SINGLE"            = 'autodetect_$TestConfig.InstanceSingle'
    # run on scenario MULTI - tests that need multiple instances
    "MULTI"             = 'autodetect_$TestConfig.InstanceMulti'
    # run on scenario COPY - tests that need to copy between instances
    "COPY"              = 'autodetect_$TestConfig.InstanceCopy'
    # run on scenario HADR - tests that need AGs, mirroring, logshipping
    "HADR"              = 'autodetect_$TestConfig.InstanceHadr'
    # run on scenario RESTART - tests that need to restart the sql instance
    "RESTART"           = 'autodetect_$TestConfig.InstanceRestart'
    "2008R2SP2Express"  = @(
        'Add-DbaDbMirrorMonitor',
        'Add-DbaDbRoleMember',
        'Add-DbaExtendedProperty',
        'Add-DbaPfDataCollectorCounter',
        'Add-DbaRegServer',
        'Add-DbaRegServerGroup',
        'Backup-DbaDatabase',
        'Backup-DbaDbMasterKey',
        'Backup-DbaServiceMasterKey',
        'Clear-DbaLatchStatistics',
        'Clear-DbaPlanCache',
        'Clear-DbaWaitStatistics',
        'Connect-DbaInstance',
        'ConvertTo-DbaXESession',
        'Copy-DbaBackupDevice',
        'Copy-DbaCredential',
        'Copy-DbaCustomError',
        'Copy-DbaDbAssembly',
        'Copy-DbaDbCertificate',
        'Copy-DbaDbTableData',
        'Copy-DbaDbViewData',
        'Copy-DbaExtendedStoredProcedure',
        'Copy-DbaInstanceTrigger',
        'Copy-DbaLinkedServer',
        'Copy-DbaLogin',
        'Copy-DbaRegServer',
        'Copy-DbaSpConfigure',
        'Copy-DbaSystemDbUserObject',
        'Disable-DbaFilestream',
        'Disable-DbaForceNetworkEncryption',
        'Disable-DbaHideInstance',
        'Disable-DbaStartupProcedure',
        'Disable-DbaTraceFlag',
        'Disconnect-DbaInstance',
        'Enable-DbaFilestream',
        'Enable-DbaForceNetworkEncryption',
        'Enable-DbaHideInstance',
        'Enable-DbaStartupProcedure',
        'Enable-DbaTraceFlag',
        'Expand-DbaDbLogFile',
        'Export-DbaBinaryFile',
        'Export-DbaCredential',
        'Export-DbaCsv',
        'Export-DbaDacPackage',
        'Export-DbaDbRole',
        'Export-DbaDbTableData',
        'Export-DbaDiagnosticQuery',
        #'Export-DbaLogin',  failes sometimes on 2008R2 - needs investigation
        'Export-DbaPfDataCollectorSetTemplate',
        'Export-DbaRegServer',
        'Export-DbaScript',
        'Export-DbaSysDbUserObject',
        'Export-DbaUser',
        'Find-DbaDatabase',
        'Find-DbaDbDisabledIndex',
        'Find-DbaDbDuplicateIndex',
        'Find-DbaDbGrowthEvent',
        #'Find-DbaDbUnusedIndex',   fails sometimes on 2008R2 - needs investigation
        'Find-DbaInstance',
        'Find-DbaOrphanedFile',
        'Find-DbaSimilarTable',
        'Find-DbaUserObject',
        'Get-DbaAvailableCollation',
        'Get-DbaBackupDevice',
        'Get-DbaBackupInformation',
        'Get-DbaBinaryFileTable',
        'Get-DbaBuild',
        'Get-DbaComputerSystem',
        'Get-DbaConnectedInstance',
        'Get-DbaConnection',
        'Get-DbaCpuRingBuffer',
        'Get-DbaCpuUsage',
        'Get-DbaCredential',
        'Get-DbaCustomError',
        'Get-DbaDatabase',
        'Get-DbaDbAssembly',
        'Get-DbaDbBackupHistory',
        'Get-DbaDbccHelp',
        'Get-DbaDbccMemoryStatus',
        'Get-DbaDbccProcCache',
        'Get-DbaDbccSessionBuffer',
        'Get-DbaDbccStatistic',
        'Get-DbaDbccUserOption',
        'Get-DbaDbCertificate',
        'Get-DbaDbCheckConstraint',
        'Get-DbaDbCompatibility',
        'Get-DbaDbCompression',
        'Get-DbaDbDbccOpenTran',
        'Get-DbaDbDetachedFileInfo',
        'Get-DbaDbEncryption',
        'Get-DbaDbExtentDiff',
        'Get-DbaDbFile',
        'Get-DbaDbFileGroup',
        'Get-DbaDbFileGrowth',
        'Get-DbaDbFileMapping',
        'Get-DbaDbForeignKey',
        'Get-DbaDbIdentity',
        'Get-DbaDbLogShipError',
        'Get-DbaDbLogSpace',
        'Get-DbaDbMailHistory',
        'Get-DbaDbMailLog',
        'Get-DbaDbMasterKey',
        'Get-DbaDbMemoryUsage',
        'Get-DbaDbMirror',
        'Get-DbaDbObjectTrigger',
        'Get-DbaDbOrphanUser',
        'Get-DbaDbRecoveryModel',
        'Get-DbaDbRestoreHistory',
        'Get-DbaDbRole',
        'Get-DbaDbRoleMember',
        'Get-DbaDbSchema',
        'Get-DbaDbServiceBrokerQueue',
        'Get-DbaDbServiceBrokerService',
        'Get-DbaDbSharePoint',
        'Get-DbaDbState',
        'Get-DbaDbStoredProcedure',
        'Get-DbaDbSynonym',
        'Get-DbaDbTable',
        'Get-DbaDbTrigger',
        'Get-DbaDbUdf',
        'Get-DbaDbUser',
        'Get-DbaDbUserDefinedTableType',
        'Get-DbaDbView',
        'Get-DbaDbVirtualLogFile',
        'Get-DbaDefaultPath',
        'Get-DbaDependency',
        'Get-DbaDeprecatedFeature',
        'Get-DbaDump',
        'Get-DbaEndpoint',
        'Get-DbaErrorLog',
        'Get-DbaEstimatedCompletionTime',
        'Get-DbaExecutionPlan',
        'Get-DbaExtendedProperty',
        'Get-DbaExtendedProtection',
        'Get-DbaExternalProcess',
        'Get-DbaFeature',
        'Get-DbaFile',
        'Get-DbaFilestream',
        'Get-DbaForceNetworkEncryption',
        'Get-DbaHelpIndex',
        'Get-DbaHideInstance',
        'Get-DbaInstalledPatch',
        'Get-DbaInstanceInstallDate',
        'Get-DbaInstanceProperty',
        'Get-DbaInstanceProtocol',
        'Get-DbaInstanceTrigger',
        'Get-DbaInstanceUserOption',
        'Get-DbaIoLatency',
        'Get-DbaLastBackup',
        'Get-DbaLastGoodCheckDb',
        'Get-DbaLatchStatistic',
        'Get-DbaLinkedServer',
        'Get-DbaLinkedServerLogin',
        'Get-DbaLogin',
        'Get-DbaMaxMemory',
        'Get-DbaMemoryCondition',
        'Get-DbaMemoryUsage',
        'Get-DbaModule',
        #'Get-DbaNetworkConfiguration',  fails on old AppVeyor image - needs investigation
        'Get-DbaOleDbProvider',
        'Get-DbaOpenTransaction',
        'Get-DbaOperatingSystem',
        'Get-DbaPbmCondition',
        'Get-DbaPbmPolicy',
        'Get-DbaPermission',
        'Get-DbaPfAvailableCounter',
        'Get-DbaPlanCache',
        'Get-DbaPowerPlan',
        'Get-DbaProcess',
        'Get-DbaProductKey',
        'Get-DbaRegistryRoot',
        'Get-DbaRegServer',
        'Get-DbaRegServerGroup',
        'Get-DbaRegServerStore',
        'Get-DbaReplDistributor',
        'Get-DbaSchemaChangeHistory',
        'Get-DbaServerRole',
        'Get-DbaServerRoleMember',
        'Get-DbaService',
        'Get-DbaSpConfigure',
        'Get-DbaSpinLockStatistic',
        'Get-DbaStartupParameter',
        'Get-DbaStartupProcedure',
        'Get-DbaSuspectPage',
        'Get-DbaTcpPort',
        'Get-DbaTopResourceUsage',
        'Get-DbaTrace',
        'Get-DbaUpTime',
        'Get-DbaUserPermission',
        'Get-DbaWaitingTask',
        'Get-DbaWaitResource',
        'Get-DbaWaitStatistic',
        'Get-DbaWindowsLog',
        'Import-DbaCsv',
        'Import-DbaPfDataCollectorSetTemplate',
        'Import-DbaRegServer',
        'Install-DbaDarlingData',
        'Install-DbaMaintenanceSolution',
        'Install-DbaSqlWatch',
        'Install-DbaWhoIsActive',
        'Invoke-DbaBalanceDataFiles',
        'Invoke-DbaCycleErrorLog',
        'Invoke-DbaDbccDropCleanBuffer',
        'Invoke-DbaDbccFreeCache',
        'Invoke-DbaDbCorruption',
        'Invoke-DbaDbDataGenerator',
        'Invoke-DbaDbDataMasking',
        'Invoke-DbaDbDbccCheckConstraint',
        'Invoke-DbaDbDbccCleanTable',
        'Invoke-DbaDbDbccUpdateUsage',
        'Invoke-DbaDbDecryptObject',
        'Invoke-DbaDbLogShipping',
        'Invoke-DbaDbPiiScan',
        'Invoke-DbaDbShrink',
        'Invoke-DbaDbTransfer',
        'Invoke-DbaWhoIsActive',
        'Measure-DbaBackupThroughput',
        'Measure-DbaDbVirtualLogFile',
        'Measure-DbaDiskSpaceRequirement',
        'Mount-DbaDatabase',
        'Move-DbaDbFile',
        'Move-DbaRegServer',
        'Move-DbaRegServerGroup',
        'New-DbaCredential',
        'New-DbaCustomError',
        'New-DbaDacOption',
        'New-DbaDacProfile',
        'New-DbaDatabase',
        'New-DbaDbCertificate',
        'New-DbaDbDataGeneratorConfig',
        'New-DbaDbMaskingConfig',
        'New-DbaDbMasterKey',
        'New-DbaDbRole',
        'New-DbaDbSchema',
        'New-DbaDbSynonym',
        'New-DbaDbTable',
        'New-DbaDbTransfer',
        'New-DbaLinkedServer',
        'New-DbaLinkedServerLogin',
        'New-DbaLogin',
        'New-DbaSsisCatalog',
        'Publish-DbaDacPackage',
        'Read-DbaTraceFile',
        'Remove-DbaCredential',
        'Remove-DbaCustomError',
        'Remove-DbaDatabase',
        'Remove-DbaDbAsymmetricKey',
        'Remove-DbaDbCertificate',
        'Remove-DbaDbCheckConstraint',
        'Remove-DbaDbData',
        'Remove-DbaDbFileGroup',
        'Remove-DbaDbLogShipping',
        'Remove-DbaDbMirrorMonitor',
        'Remove-DbaDbOrphanUser',
        'Remove-DbaDbRole',
        'Remove-DbaDbSchema',
        'Remove-DbaDbTable',
        'Remove-DbaDbUdf',
        'Remove-DbaDbUser',
        'Remove-DbaDbView',
        'Remove-DbaExtendedProperty',
        'Remove-DbaLinkedServer',
        'Remove-DbaLinkedServerLogin',
        'Remove-DbaLogin',
        'Remove-DbaPfDataCollectorCounter',
        'Remove-DbaPfDataCollectorSet',
        'Remove-DbaRegServer',
        'Remove-DbaRegServerGroup',
        'Remove-DbaTrace',
        'Rename-DbaLogin',
        'Repair-DbaDbOrphanUser',
        'Reset-DbaAdmin',
        'Restore-DbaDbCertificate',
        'Set-DbaDbCompatibility',
        'Set-DbaDbFileGrowth',
        'Set-DbaDbOwner',
        'Set-DbaDbRecoveryModel',
        'Set-DbaDbSchema',
        'Set-DbaDbState',
        'Set-DbaDefaultPath',
        'Set-DbaErrorLogConfig',
        'Set-DbaExtendedProperty',
        'Set-DbaExtendedProtection',
        'Set-DbaLogin',
        'Set-DbaMaxDop',
        'Set-DbaMaxMemory',
        'Set-DbaNetworkConfiguration',
        'Set-DbaSpConfigure',
        'Set-DbaTcpPort',
        'Set-DbaTempDbConfig',
        'Start-DbaMigration',
        'Start-DbaTrace',
        'Stop-DbaAgentJob',
        'Stop-DbaExternalProcess',
        'Stop-DbaProcess',
        'Stop-DbaTrace',
        'Sync-DbaLoginPassword',
        'Sync-DbaLoginPermission',
        'Test-DbaBuild',
        'Test-DbaConnection',
        'Test-DbaConnectionAuthScheme',
        'Test-DbaDbCollation',
        'Test-DbaDbCompatibility',
        'Test-DbaDbDataGeneratorConfig',
        'Test-DbaDbDataMaskingConfig',
        'Test-DbaDbOwner',
        'Test-DbaDbRecoveryModel',
        'Test-DbaDiskAlignment',
        'Test-DbaDiskAllocation',
        'Test-DbaDiskSpeed',
        'Test-DbaIdentityUsage',
        'Test-DbaInstanceName',
        'Test-DbaLastBackup',
        'Test-DbaLinkedServerConnection',
        'Test-DbaLoginPassword',
        'Test-DbaManagementObject',
        'Test-DbaMaxDop',
        'Test-DbaMigrationConstraint',
        'Test-DbaNetworkLatency',
        'Test-DbaOptimizeForAdHoc',
        'Test-DbaPath',
        'Test-DbaPowerPlan',
        'Test-DbaSpn',
        'Test-DbaTempDbConfig',
        'Test-DbaWindowsLogin',
        'Test-PSRemoting',
        'Uninstall-DbaSqlWatch',
        'Update-DbaInstance',
        'Watch-DbaDbLogin',
        'Write-DbaDbTableData'
    )
    # run unit tests only (no SQL Server required) -- used by UNIT_TESTS_ONLY scenario
    "UNIT_TESTS_ONLY"   = 'autodetect_UnitTests'
    # do not run on appveyor
    "appveyor_disabled" = @(
        # Database Mirroring monitoring SPs removed in SQL Server 2022
        # AppVeyor uses SQL 2022 as primary target -- re-enable when testing against older SQL versions
        'Remove-DbaDbMirrorMonitor',
        'Add-DbaDbMirrorMonitor',
        # Service management via WMI requires elevated local WMI permissions not available on AppVeyor agents
        # These tests pass in local lab environments with proper WMI access
        'Set-DbaTcpPort',
        'Update-DbaServiceAccount',
        # Stop-DbaService is timing-sensitive in CI; passes locally but flaky in AppVeyor
        'Stop-DbaService'
    )
    # do not run everywhere
    "disabled"          = @()
}